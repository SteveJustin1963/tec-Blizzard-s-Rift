
HOLD   equ 32750
TRANS  equ 32753
SSCOR  equ 32756
HITSHP equ 32759
FTEST  equ 32762
JOYKEY equ 32765

CH001  equ 16425
CH002  equ 16425+32
CH003  equ 16425+64
CH004  equ 16425+96
CH005  equ 16425+128
CH006  equ 16425+160
CH007  equ 16425+192
CH008  equ 18441
CH009  equ 18441+32
CH010  equ 18441+64
CH011  equ 18441+96
CH012  equ 18441+128
CH013  equ 18441+160
CH014  equ 18441+192
CH015  equ 18441+224
CH016  equ 20489
CH017  equ 20489+32
CH018  equ 20489+64
CH019  equ 20489+96
CH020  equ 20489+128
CH021  equ 20489+160
CH022  equ 20489+192




; Start address to which we're compiling.
; Maximise the Spectrum's RAM by placing code at 24256.


       org 24000


; Save RAM bank to tape.

       ld ix,49152
       ld de,termin-49152
       ld a,255
       call 1218
       ret



       org 32750

hold   ret
       defb 0,0
trans  jp txfer
upsc   ret
       defb 0,0
hitshp ret
       defb 0,0

ftest  and a
       ret
       defb 0

       jp joykey

; User defined keys.

keys   defb 28,27,35,16,1


; Joystick and keyboard reading routines.

joykey ld a,(contrl)       ; control flag.
       and a               ; is it the keyboard?
       jr nz,joyjoy        ; no, it's joystick.

; Keyboard controls.

       ld e,0              ; control.
       ld a,(keys+3)       ; fire key.
       call ktest          ; being pressed?
       ccf                 ; complement the carry.
       rl e                ; rotate into e register.
       ld a,(keys)         ; up key.
       call ktest          ; being pressed?
       ccf                 ; complement the carry.
       rl e                ; rotate into e register.
       rl e                ; rotate into e register.
       ld a,(keys+1)       ; left key.
       call ktest          ; being pressed?
       ccf                 ; complement the carry.
       rl e                ; rotate into bit d0 of e register.
       ld a,(keys+2)       ; left key.
       call ktest          ; being pressed?
       ccf                 ; complement the carry.
       rl e                ; destined for bit d1 of e register.
       ld a,e              ; place result in accumulator.
       ld (joyval),a       ; put that into joyval.
       ret

joyjoy dec a               ; is it Kempston?
       jr z,joykem         ; yes.

; Sinclair joystick controls.

joysin ld bc,61438         ; port for Sinclair 2.
       in a,(c)            ; read joystick.
       ld d,a              ; clear values.
       xor a               ; clear accumulator.
       ld e,16             ; Kempston fire bit value.
       bit 0,d             ; fire bit pressed?
       call z,joysi0       ; add bit.
       ld e,1              ; Kempston bit value.
       bit 3,d             ; fire bit pressed?
       call z,joysi0       ; add bit.
       ld e,2              ; Kempston bit value.
       bit 4,d             ; fire bit pressed?
       call z,joysi0       ; add bit.
       ld e,8              ; Kempston bit value.
       bit 1,d             ; fire bit pressed?
       call z,joysi0       ; add bit.
       ld e,4              ; Kempston bit value.
       bit 2,d             ; fire bit pressed?
       call z,joysi0       ; add bit.
       ld (joyval),a       ; remember value.
       ret

joysi0 add a,e             ; add bit value.
       ret


; Kempston joystick controls.

joykem ld bc,31            ; port for Kempston interface.
       in a,(c)            ; read it.
       ld (joyval),a       ; remember value.
       ret

contrl defb 0              ; control method.
joyval defb 0              ; value returned.



; Key test routine.

ktest  ld c,a              ; key to test in c.
       and 7               ; mask bits d0-d2 for row.
       inc a               ; in range 1-8.
       ld b,a              ; place in b.
       srl c               ; divide c by 8
       srl c               ; to find position within row.
       srl c
       ld a,5              ; only 5 keys per row.
       sub c               ; subtract position.
       ld c,a              ; put in c.
       ld a,254            ; high byte of port to read.
ktest0 rrca                ; rotate into position.
       djnz ktest0         ; repeat until we've found relevant row.
       in a,(254)          ; read port (a=high, 254=low).
ktest1 rra                 ; rotate bit out of result.
       dec c               ; loop counter.
       jp nz,ktest1        ; repeat until bit for position in carry.
       ret




       org 49152

; Set up.

       ld hl,0             ; zeroes.
       ld (frame),hl       ; set frame count.



; Initialisation.

run    ld hl,window        ; first byte.
       ld de,window+1      ; next one.
       ld bc,winend-window ; length.
       ld (hl),0           ; clear first byte.
       ldir                ; clear the remainder.
       ld hl,txfer         ; window transfer routine.
       ld (trans+1),hl     ; set that up for pause routine.
       ld b,0
run1   push bc             ; process count.
       call pstar          ; process starfield.
       pop bc              ; restore count.
       djnz run1           ; repeat.
       ld a,104            ; default centre.
       ld (ycent),a        ; centre of screen.
       ld a,72             ; default centre.
       ld (xcent),a        ; centre of screen.
       call wstr0          ; first message.

; Main loop.

mloop  call dstar          ; display starfield.
       call dlaser         ; show laser.
       call dscav          ; show scavenger.
       call txfer
       call HOLD           ; pause routine.
       call dscav          ; delete scavenger.
       call dlaser         ; delete laser.
       call dstar          ; delete starfield.
       call pscav          ; process scavenger.
       call cdet           ; collision detection.
       call text           ; text routine.
       call JOYKEY         ; joystick/keyboard routines.
       rra                 ; check bit zero.
       push af             ; store result.
       call c,msr          ; move ship right.
       pop af
       rra                 ; check bit one.
       push af             ; store result.
       call c,msl          ; move ship left.
       pop af              ; restore control byte.
       rra
       rra
       push af             ; store result.
       jp nc,msd           ; move down.
       call c,msu          ; move ship up.
mloop0 pop af              ; restore control byte.
       rra                 ; fire status.
       call nc,nofire      ; not fired.
       call c,flaser       ; fire laser.
       call plaser         ; process laser gun.

       call pstar          ; process starfield.
       call SSCOR          ; show score.

       ld hl,(frame)       ; current frame count.
       inc hl              ; increment it.
       ld (frame),hl       ; set frame count.
       ld a,h              ; high byte.
       cp 5                ; reached system yet?
       jr c,mloop          ; not yet.
       ret


; Process starfield.

pstar  ld a,(frame+1)      ; frame.
       cp 4                ; deceleration phase?
       jp c,pstar3         ; no, carry on.
       ld a,(frame)        ; frame low.
       rra                 ; check lowest bit.
       ret c               ; don't move stars this frame.
pstar3 ld ix,strtab        ; table of stars.
       ld b,60             ; number to process.
pstar0 push bc             ; put star counter on stack.
       ld a,(ix)           ; on/off flag.
       call pstar1         ; process it.
       pop bc              ; restore star counter.
       ld de,6             ; distance to next star.
       add ix,de           ; point to next one.
       djnz pstar0         ; repeat for all stars.
       ret
pstar1 and a               ; is it switched on?
       jp nz,pstar2        ; yes, process it.
       call random         ; random number.
       and 127             ; 1 in 256 chance?
       ret nz              ; nothing to generate.
       ld (ix),1           ; enable star.
       call random         ; random number.
       ld (ix+1),a         ; set the angle.
       call random         ; random speed.
       and 128
       ld (ix+2),a         ; speed fraction.
       ld (ix+3),0         ; speed integer.
       ld (ix+4),0         ; distance fraction.
       ld (ix+5),0         ; distance integer.
       ret
pstar2 ld l,(ix+2)         ; speed fraction.
       ld h,(ix+3)         ; speed integer.
       ld de,2             ; amount to add.
       add hl,de           ; new speed.
       ld (ix+2),l         ; speed fraction.
       ld (ix+3),h         ; speed integer.
       ld e,(ix+4)         ; distance.
       ld d,(ix+5)         ; distance integer.
       call add            ; add the two.
       ld a,h              ; integer part.
       cp 152              ; hit the max distance?
       jr nc,dstar2        ; yes, kill it.
       ld (ix+4),l         ; new distance.
       ld (ix+5),h         ; integer part.
       ret




; Display starfield.

dstar  ld ix,strtab        ; table of stars.
       ld b,60             ; number to process.
dstar0 push bc             ; put star counter on stack.
       ld a,(ix)           ; on/off flag.
       and a               ; is it switched on?
       call nz,dstar1      ; yes, process it.
       pop bc              ; restore star counter.
       ld de,6             ; distance to next star.
       add ix,de           ; point to next one.
       djnz dstar0         ; repeat for all stars.
       ret

dstar1 ld a,(ix+5)         ; integer distance.
       cp 7                ; minimum distance from focal point.
       ret c               ; not worth displaying.
       ld a,(ix+1)         ; angle.
       call sin            ; sine of angle in hl.
       ld l,(ix+4)         ; distance from focal point.
       ld h,(ix+5)         ; integer component.
       call mul            ; multiply distance by sine.
       ld a,(ycent)        ; y centre.
       ld d,a              ; set integer.
       ld e,0              ; no sign/fraction.
       call add            ; displacement.
       ld a,l              ; sign/fraction part of result.
       rra                 ; check sign.
       ret c               ; negative, don't display it.
;       jr c,dstar2         ; negative, so kill star off.
       ld a,h              ; integer part of result.
       cp 208              ; within range?
       jr nc,dstar2        ; no, kill it.
       ld (dispy),a        ; set the coordinate.

       ld a,(ix+1)         ; angle.
       call cos            ; cosine of angle in hl.
       ld l,(ix+4)         ; distance from focal point.
       ld h,(ix+5)         ; integer component.
       call mul            ; multiply distance by cosine.
       ld a,(xcent)        ; x centre.
       ld d,a              ; set integer.
       ld e,0              ; no sign/fraction.

       call add            ; displacement.
       ld a,l              ; sign/fraction part of result.
       rra                 ; check sign.
       jr c,dstar2         ; negative, so kill star off.
       ld a,h              ; integer part of result.
       cp 192              ; within range?
       jr nc,dstar2        ; no, kill it.
       ld (dispx),a        ; set the coordinate.
       jp wplot            ; plot the star.
dstar2 ld (ix),0           ; switch it off.
       ret

msr    ld hl,strtab+1      ; table of stars' angles.
       ld b,60             ; number to process.
       ld de,6             ; distance to next star.
msr0   inc (hl)            ; change angle.
       add hl,de           ; point to next one.
       djnz msr0           ; repeat for all stars.
       ld hl,scava         ; scavenger angle.
       inc (hl)            ; swivel that too.
       ld hl,ycent         ; centre of screen.
       ld a,(hl)           ; present value.
       cp 64               ; minimum?
       ret z               ; yes, go no further.
       dec (hl)            ; move.
       dec (hl)            ; move.
       ret

msl    ld hl,strtab+1      ; table of stars' angles.
       ld b,60             ; number to process.
       ld de,6             ; distance to next star.
msl0   dec (hl)            ; change angle.
       add hl,de           ; point to next one.
       djnz msl0           ; repeat for all stars.
       ld hl,scava         ; scavenger angle.
       dec (hl)            ; swivel that too.
       ld hl,ycent         ; centre of screen.
       ld a,(hl)           ; present value.
       cp 144              ; maximum?
       ret z               ; yes, go no further.
       inc (hl)            ; move.
       inc (hl)            ; move.
       ret


msd    ld hl,xcent         ; centre of screen.
       ld a,(hl)           ; present value.
       cp 64               ; maximum?
       jp z,mloop0         ; yes, go no further.
       dec (hl)            ; move.
       dec (hl)            ; move.
       jp mloop0

msu    ld hl,xcent         ; centre of screen.
       ld a,(hl)           ; present value.
       cp 144              ; maximum?
       ret z               ; yes, go no further.
       inc (hl)            ; move.
       inc (hl)            ; move.
       ret

nofire xor a               ; clear flags/accumulator.
       ld (firefl),a       ; set fire flag.
       ret

firefl defb 0              ; fire debounce flag.

flaser ld hl,firefl        ; Must release key between bullets.
       ld a,(hl)           ; fire already pressed flag.
       and a               ; pressed last time?
       ret nz              ; yes, release before firing again.
       inc (hl)            ; set pressed flag.
       call ftest          ; check we have bullets remaining.
       ret c               ; we don't, so can't fire.
       ld ix,lastab        ; laser table.
       ld b,8              ; number of bullets.
flas1  push bc             ; store counter.
       ld a,(ix)           ; on/off flag.
       and a               ; is it enabled?
       jp z,flas0          ; no, start it off.
       ld de,7             ; each entry is 6 bytes.
       add ix,de           ; point to next entry.
       pop bc              ; restore laser count.
       djnz flas1          ; repeat till all entries tried.
       ret
flas0  pop bc              ; remove counter from stack.
       ld (ix),1           ; switch this laser on.
       ld a,(ycent)        ; y position when fired.
       ld (ix+1),a         ; y position when fired.
       ld a,(xcent)        ; x position when fired.
       ld (ix+6),a         ; store that in table.

       ld hl,ycent         ; current centre of screen.
       ld (ix+2),4         ; frame number.
       ret

dlaser ld ix,lastab        ; laser table.
       ld b,8              ; number of bullets.
dlas1  push bc             ; store counter.
       ld a,(ix)           ; on/off flag.
       and a               ; is it enabled?
       call nz,dlas0       ; yes.
       ld de,7             ; table size.
       add ix,de           ; point to next one.
       pop bc              ; restore laser count.
       djnz dlas1          ; repeat till all entries drawn.
       ret
dlas0  ld l,(ix+3)         ; x coord.
       ld h,(ix+4)         ; first y coord.
       ld (dispx),hl       ; set display coordinates.
       call wdot           ; show dot.
       ld l,(ix+3)         ; x coord.
       ld h,(ix+5)         ; second y coord.
       ld (dispx),hl       ; set display coordinates.
       jp wdot             ; show dot.


plaser ld ix,lastab        ; laser table.
       ld b,8              ; number of bullets.
plas1  push bc             ; store counter.
       ld a,(ix)           ; on/off flag.
       and a               ; is it enabled?
       call nz,plas0       ; yes, process it.
       pop bc              ; restore laser count.
       ld de,7             ; size of table.
       add ix,de           ; point to next one.
       djnz plas1          ; repeat till all entries processed.
       ret

plas0  ld hl,350           ; multiplier.
       ld a,(ix+2)         ; frame number.
       ld d,a              ; integer.
       call idiv           ; find total multiplier.
       ld h,l              ; result in h.
       ld l,0              ; no sign/fraction.
       push hl             ; store multiplier.
       push hl             ; store multiplier.
       push hl             ; store multiplier.

       ld a,32             ; angle.
       call sin            ; find sine.
       pop hl              ; restore multiplier.
       call mul            ; multiply them together.
       ld a,(ycent)        ; current centre.
       sub (ix+1)          ; y displacement when fired.
       add a,104           ; add default.

       ld d,a              ; integer part.
       ld e,0              ; no sign.
       call add            ; add to coords.
       ld a,h              ; integer part.
       ld (ix+4),a         ; set y coord.

       ld a,96             ; angle.
       call sin            ; find sine.
       pop hl              ; restore multiplier.
       call mul            ; multiply them together.
       ld a,(ycent)        ; current centre.
       sub (ix+1)          ; y displacement when fired.
       add a,104           ; add default.
       ld d,a              ; integer part.
       ld e,0              ; no sign.
       call add            ; add to coords.
       ld a,h              ; integer part.
       ld (ix+5),a         ; set second y coord.

       ld a,32             ; angle.
       call cos            ; find cosine.
       pop hl              ; restore multiplier.
       call mul            ; multiply them together.
       ld a,(xcent)        ; current centre.
       sub (ix+6)          ; x displacement when fired.
       add a,80            ; add default.
       ld d,a              ; integer part.
       ld e,0              ; no sign.
       call add            ; add to coords.
       ld a,h              ; integer part.
       ld (ix+3),a         ; set x coord.

       ld a,(ix+2)         ; frame.
       inc a               ; increment it.
       ld (ix+2),a         ; new value.
       cp 45               ; reached end?
       ret nz              ; no, not yet.
       ld (ix),0           ; reset laser.

       ret






dispx  defb 0              ; general purpose x coordinate.
dispy  defb 0              ; same for y.




; Get cosine of angle passed in the accumulator, and return in de pair.

cos    add a,64            ; DE = cosine A.

; Find sine of angle in accumulator, return in de registers.

sin    ld hl,sine          ; DE = sine A.
       ld d,0              ; zeroise high byte.
       and a               ; clear carry flag.
       rla                 ; multiply accumulator by 2.
       rl d                ; shift top bit into high byte.
       ld e,a              ; put remainder in low byte.
       add hl,de           ; add displacement to start of table.
       ld e,(hl)           ; get low value of sine value.
       inc hl              ; next byte along.
       ld d,(hl)           ; fetch high byte.
       ret

; Search sine table for arcsine of de and return angle in a.
; Passing a negative sine may slightly reduce accuracy.

; 16-bit mathematics routines.
; 8 bits=integer
; 7 bits=decimal places
; 1 bit sign.

sub    ld a,1              ; HL = HL - DE
       xor e
       ld e,a
add    ld a,l              ; HL = HL + DE
       and 1
       ld c,a
       ld a,e
       and 1
       xor c
       jr nz,add1
       res 0,l
       res 0,e
       add hl,de
       ld a,l
       or c
       ld l,a
       ret
add1   bit 0,c
       jr z,add3
       ex de,hl
add3   res 0,l
       res 0,e
       sbc hl,de
       jr c,add2
       ret
add2   ex de,hl
       ld hl,2
       sbc hl,de
       ret
div    ld a,l              ; HL = HL / DE
       xor e
       and 1
       push af
       xor a
       ld c,d
       ld d,e
       ld e,a
       call div4
       push af
       call div4
       and 254
       ld l,a
       pop de
       pop af
       or l
       ld l,a
       ld h,d
       ret
div4   ld b,8
div1   rr c
       rr d
       rr e
       ex af,af'
       xor a
       cp c
       jr z,div2
       ex af,af'
div3   rla
       and a
       djnz div1
       ret
div2   ex af,af'
       ld (mtbuff),hl
       sbc hl,de
       ccf
       jr c,div3
       ld hl,(mtbuff)
       jp div3

; Multiply hl by de and return in hl.

mul    ld a,l              ; sign of hl.
       xor e               ; merge with sign of de.
       and 1               ; now in accumulator.
       push af             ; store sign
       res 0,l             ; clear sign of hl.
       ld a,e              ; de low to accumulator.
       and 254             ; remove sign.
       ld e,d              ; high byte of de to e.
       ld b,h
       ld c,l
       ld hl,0
       ld d,h
       ex af,af'
       ld a,16
mul1   ex af,af'           ; store counter in alternate set.
       rr b
       rr c
       jr nc,mul2          ; bit not set, no addition this time.
       add hl,de           ; add to total.
       and a               ; clear carry.
mul2   rla
       rl e
       rl d
       ex af,af'           ; restore counter.
       dec a               ; one less iteration.
       jp nz,mul1          ; keep going.
       ld a,l              ; result fraction/sign.
       and 254             ; mask off sign.
       pop bc              ; restore sign in b.
       or b                ; combine with accumulator.
       ld l,a              ; add sign to hl.
       ret

; Divide hl by d and return in hl.

idiv   xor a               ; HL = HL / D
       ld c,a              ; zeroise c.
       ld e,a              ; zeroise e.
       call idiv4
       push af
       xor a
       ld c,a
       ld d,a
       call idiv4
       pop hl
       ld l,h
       ld h,a
       ret
idiv4  ld b,8
idiv1  rr d
       rr e
       rr c
       ex af,af'           ; store flag.
       xor a               ; zeroise accumulator.
       cp c                ; is c zero?
       jr z,idiv2          ; yes.
       ex af,af'           ; restore flags.
idiv3  rla                 ; rotate into right of accumulator.
       and a               ; reset carry.
       djnz idiv1          ; repeat 8 times.
       ret
idiv2  ex af,af'
       ld (mtbuff),hl
       sbc hl,de
       ccf
       jr c,idiv3
       ld hl,(mtbuff)
       jp idiv3



stptr  defw 0

; Outlaw ship sprites.

shpgfx equ $
       defb 0,0,0,0,0,0,0,0,0,0,0,0,2,64,3,192
       defb 3,192,2,64,0,0,0,0,0,0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0,0,0,0,4,32,5,160,7,224
       defb 5,160,4,32,0,0,0,0,0,0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0,0,4,32,9,144,11,208,15,240
       defb 11,208,9,144,4,32,0,0,0,0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,4,32,8,16,9,144,19,200,31,248
       defb 19,200,9,144,8,16,4,32,0,0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,8,16,8,16,19,200,19,200,31,248
       defb 19,200,19,200,8,16,8,16,0,0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,8,16,16,8,35,196,39,228,63,252
       defb 39,228,39,228,35,196,16,8,8,16,0,0,0,0,0,0
       defb 0,0,0,0,16,8,32,4,33,132,103,230,71,226,127,254
       defb 127,254,71,226,99,198,32,4,32,4,16,8,0,0,0,0
       defb 0,0,0,0,32,4,96,6,67,194,199,227,207,243,255,255
       defb 255,255,207,243,199,227,67,194,96,6,32,4,0,0,0,0


cdet   ld a,(scavf)        ; scavenger on flag.
       and a               ; is it on?
       ret z               ; no, no detection required.
       ld a,(scavd+1)      ; scavenger distance.
       cp 16               ; long way away?
       ret c               ; yes, no collision possible.
       cp 80               ; too close?
       ret nc              ; yes, no collision possible.
       ld ix,lastab        ; laser table.
       ld b,8              ; number of bullets.
cdet1  push bc             ; store counter.
       ld a,(ix)           ; on/off flag.
       and a               ; is it enabled?
       call nz,cdet0       ; yes.
       ld de,7             ; table size.
       add ix,de           ; point to next one.
       pop bc              ; restore laser count.
       djnz cdet1          ; repeat till all entries drawn.
       ret
cdet0  ld a,(ix+2)         ; frame.
       cp 15               ; past first few frames?
       ret c               ; no, leave this laser.
       cp 37               ; gone too far?
       ret nc              ; yes, leave this laser.
       ld a,(scavx)        ; scavenger x.
       add a,10            ; leeway + x centre.
       sub (ix+3)          ; real x coord.
       cp 6                ; within range?
       ret nc              ; no, collision fails.
       ld a,(scavy)        ; scavenger y.
       add a,11            ; leeway + y centre.
       sub (ix+4)          ; real y coord.
       cp 8                ; within range?
       jr c,hit            ; yes, collision succeeds.
       ld a,(scavy)        ; scavenger y.
       add a,11            ; leeway + y centre.
       sub (ix+5)          ; real y coord.
       cp 8                ; within range?
       ret nc              ; no, collision fails.
hit    xor a               ; zero in accumulator.
       ld (scavf),a        ; write to scavenger on/off flag.
       ld (ix),a           ; switch off laser.
       pop de              ; return address.
       pop bc              ; loop counter.
       ld c,16             ; bits of explosion.
       ld ix,strtab        ; table of stars.
       ld b,60             ; number to process.
hit0   ld a,(ix)           ; on/off flag.
       and a               ; is it enabled?
       call z,hit1         ; no, process it.
       ld de,6             ; distance to next star.
       add ix,de           ; point to next one.
       djnz hit0           ; repeat for all stars.
       jp HITSHP           ; increment the score.
hit1   ld (ix),b           ; enable dot.
       call random         ; random number.
       and 15              ; range 0-7.
       sub 8
       ld hl,scava         ; angle.
       add a,(hl)          ; add angle.
       ld (ix+1),a         ; set dot angle.
       ld hl,(scavd)       ; scavenger distance.
       call random         ; speed.
       and 3               ; range 0-3.
       add a,3             ; minimum speed 3.
       ld (ix+3),a         ; speed.
       ld (ix+4),l         ; dot distance.
       ld (ix+5),h         ; dot distance.
       dec c               ; one less to do.
       ret nz              ; keep going.
       pop de              ; don't go bak to hit0 loop.
       jp HITSHP           ; increment the score.


scavf  defb 0              ; scavenger enabled, 0 = off.
scava  defb 0              ; scavenger angle.
scavx  defb 0              ; x coord.
scavy  defb 0              ; y coord.
scavd  defw 0              ; distance from focal point.
scavs  defw 0              ; speed.

; Process scavenger.

pscav  ld a,(scavf)        ; on/off flag.
       and a               ; is it on?
       jr z,pscav0         ; no.
       ld hl,(scavs)       ; scavenger speed.
       ld de,2             ; acceleration.
       call add            ; increase speed.
       ld (scavs),hl       ; new speed.
       ld de,(scavd)       ; distance.
       call add            ; new distance.
       ld (scavd),hl       ; store that for next time.
       ld a,h              ; integer part of distance.
       cp 130              ; reached max distance?
       ret c               ; not yet.
       xor a               ; clear accumulator.
       ld (scavf),a        ; reset ship.
       ret

pscav0 ld a,(frame+1)      ; timer.
       cp 4                ; near end of sequence?
       ret nc              ; yes, don't generate a scavenger.
       call random         ; random number.
       cp 14               ; chance of appearing.
       ret nz              ; don't bother yet.
       inc a               ; non-zero value.
       ld (scavf),a        ; enable it.
       call random         ; random number.
       ld (scava),a        ; set the angle.
       ld hl,0             ; distance from focal point.
       ld (scavd),hl       ; set distance.
       ld (scavs),hl       ; set speed.
       ret

dscav0 ld a,63             ; maximum.
       ret

; Display scavenger.

dscav  ld a,(scavf)        ; scavenger enabled flag.
       and a               ; switched on?
       ret z               ; no, nothing to show.
       ld a,(scava)        ; angle.
       call sin            ; sine of angle in hl.
       ld hl,(scavd)       ; distance from focal point.
       call mul            ; multiply distance by sine.
       ld a,(ycent)        ; x centre.
       ld d,a              ; set integer.
       ld e,0              ; no sign/fraction.
       call add            ; displacement.
       ld a,l              ; sign/fraction part of result.
       rra                 ; check sign.
       ret c               ; negative, so don't show it.
       ld a,h              ; integer part of result.
       cp 192              ; within range?
       ret nc              ; no, nothing to show.
       ld (scavy),a        ; set the coordinate.
       sub 8               ; left edge coord.
       ld (dispy),a        ; display coord.

       ld a,(scava)        ; angle.
       call cos            ; cosine of angle in hl.
       ld hl,(scavd)       ; distance from focal point.
       call mul            ; multiply distance by cosine.
;       ld de,104*256       ; centre of screen.
       ld a,(xcent)        ; x centre.
       ld d,a              ; set integer.
       ld e,0              ; no sign/fraction.

       call add            ; displacement.
       ld a,l              ; sign/fraction part of result.
       rra                 ; check sign.
       ret c               ; negative, so don't show it.
       ld a,h              ; integer part of result.
       cp 176              ; within range?
       ret nc              ; no, don't display.
       ld (scavx),a        ; set the coordinate.
       sub 8               ; top edge coord.
       ld (dispx),a        ; display coord.
       ld a,(scavd+1)      ; distance from focal point.
       cp 64               ; past max distance?
       call nc,dscav0      ; yes, set to maximum.
       rlca                ; multiply by 4.
       rlca                ;
       and 224             ; mask away unwanted bits.
       ld e,a              ; low byte of displacement.
       ld d,0              ; less than 256 so no high byte.
       ld hl,shpgfx        ; sprite images.
       add hl,de           ; point to correct one.
       ld (source),hl      ; set source image.

; Draw/delete sprite.

sprite call wadd           ; get window address.
       ld (target),hl      ; target address.
       ld a,16             ; vertical lines.
sprit2 ex af,af'           ; store in alternate register set.
       ld hl,(source)      ; source address.
       ld a,(dispy)        ; y coord.
       and 7               ; shifts required.
       jr z,sprit0         ; none, transfer to window.
       ld b,a              ; number of iterations.
       ld a,(hl)           ; first byte of graphic.
       inc hl              ; next byte of graphic.
       ld e,(hl)           ; second byte.
       inc hl              ; point to next line.
       ld (source),hl      ; store source.
       ld d,0              ; empty third byte.
sprit1 rra                 ; rotate left byte.
       rr e                ; rotate middle byte.
       rr d                ; rotate right byte.
       djnz sprit1         ; repeat until all shifted.
sprit3 ld hl,(target)      ; target address in hl.
       xor (hl)            ; combine first byte with window.
       ld (hl),a           ; write to window.
       inc hl              ; next byte.
       ld a,e              ; second byte.
       xor (hl)            ; combine byte with window.
       ld (hl),a           ; write to window.
       inc hl              ; next byte.
       ld a,d              ; third byte.
       xor (hl)            ; combine last byte with window.
       ld (hl),a           ; write to window.
       ld de,24            ; distance to next line.
       add hl,de           ; next line down.
       ld (target),hl      ; store target address.
       ex af,af'           ; store in alternate register set.
       dec a               ; one less line to do.
       jp nz,sprit2        ; repeat for rest of sprite.
       ret
sprit0 ld d,a              ; third byte.
       ld a,(hl)           ; first byte.
       inc hl              ; next byte of graphic.
       ld e,(hl)           ; second byte.
       inc hl              ; point to next line.
       ld (source),hl      ; store source.
       jp sprit3


target defw 0              ; target address.
source defw 0



; Transfer window to screen.

txfer  ld hl,window+2      ; buffer to display.
       ld de,CH001         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH001+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH001+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH001+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH001+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH001+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH001+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH001+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH002+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH003+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH004+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH005+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH006+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH007+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH008+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH009+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH010+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH011+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH012+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH013+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH014+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH015+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH016+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH017+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH018+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH019+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH020+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH021+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022         ; the very first pixel line of the window.
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022+256
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022+512
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022+768
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022+1024
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022+1280
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022+1536
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       inc l
       inc hl
       inc l
       inc hl
       ld de,CH022+1792
       ldi                 ; transfer byte 1.
       ldi                 ; transfer byte 2.
       ldi                 ; transfer byte 3.
       ldi                 ; transfer byte 4.
       ldi                 ; transfer byte 5.
       ldi                 ; transfer byte 6.
       ldi                 ; transfer byte 7.
       ldi                 ; transfer byte 8.
       ldi                 ; transfer byte 9.
       ldi                 ; transfer byte 10.
       ldi                 ; transfer byte 11.
       ldi                 ; transfer byte 12.
       ldi                 ; transfer byte 13.
       ldi                 ; transfer byte 14.
       ldi                 ; transfer byte 15.
       ldi                 ; transfer byte 16.
       ldi                 ; transfer byte 17.
       ldi                 ; transfer byte 18.
       ldi                 ; transfer byte 19.
       ldi                 ; transfer byte 20.
       ldi                 ; transfer byte 21.
       ldi                 ; transfer byte 22.
       ret


; Laser table.
; ix     = on/off, 0 = off.
; ix + 1 = y displacement.
; ix + 2 = frame number.
; ix + 3 = real x coord.
; ix + 4 = real y coord 1.
; ix + 5 = real y coord 2.
; ix + 6 = x displacement.

lastab defb 0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0
       defb 0,0,0,0,0,0,0


xcent  defb 104            ; centre of screen.
ycent  defb 104            ; centre of screen.
frame  defw 0              ; frame counter.

; Star table.
; ix     = on/off, 0 = off.
; ix + 1 = angle.
; ix + 2 = speed.
; ix + 4 = distance.

strtab defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0
       defw 0,0,0,0,0,0,0,0,0,0,0,0


; Window character display routine.

wchr   defb 17,160,24      ; position.
       ld (dispx),de       ; set display position.
wchr1  ld a,(hl)           ; char to display.
       and a               ; is it terminator character?
       ret z               ; yes, job done.
       push hl             ; store address.
       rlca                ; char by 8.
       rlca
       rlca
       ld d,a              ; store in d.
       and 248             ; low bits.
       ld e,a              ; put those in e.
       ld a,d              ; restore shift result.
       and 3               ; high bits.
       ld d,a              ; need those in d.
       ld hl,(23606)       ; ROM font.
       add hl,de           ; point to this character.
       push hl             ; store source address.
       call wadd           ; address to put string.
       pop de              ; restore source address.
       ld b,8              ; bytes to write.
wchr0  push bc             ; store counter on stack.
       ld a,(de)           ; image data.
       xor (hl)            ; combine with that on screen.
       ld (hl),a           ; write to screen.
       ld bc,26            ; distance to next line.
       add hl,bc           ; point to next line.
       inc de              ; next line of char.
       pop bc              ; restore loop counter.
       djnz wchr0          ; rest of char.
       ld a,(dispy)        ; y coordinate.
       add a,8             ; move along 8 pixels.
       ld (dispy),a        ; next position.
       pop hl              ; restore string address.
       inc hl              ; point to next character.
       jp wchr1

strn0  defb 'ION DRIVE ENGAGED',0
strn1  defb 'DESTINATION SYSTEM',0

wstr0  ld hl,strn0         ; ion drive engaged.
       jp wchr
wstr1  ld hl,strn1         ; destination system.
       jp wchr

text   ld a,(frame)        ; frame low.
       cp 128              ; check state.
       ret nz              ; nothing to do.
       ld a,(frame+1)      ; frame high.
       and a               ; just started?
       jr z,wstr0          ; delete first message.
       cp 4                ; nearing end?
       jr z,wstr1          ; yes, display message.
       ret


; Window dot - larger than plot.

wdot   ld a,(dispy)        ; horizontal position.
       and 7               ; position straddling character cells.
       rlca                ; multiply by 2.
       ld d,0              ; zero high byte of de.
       ld e,a              ; displacement in de.
       ld hl,wpixl2        ; pixels.
       add hl,de           ; point to pixels.
       ld c,(hl)           ; first pixel.
       inc hl              ; next pixel.
       ld b,(hl)           ; second pixel.
       push bc             ; store data.
       call wadd           ; find window address.
       pop bc              ; restore data.
       ld a,(hl)           ; first graphic address.
       xor c               ; combine with pixel.
       ld (hl),a           ; new value.
       inc hl              ; next pixel.
       ld a,(hl)           ; second graphic address.
       xor b               ; combine with pixel.
       ld (hl),a           ; new value.
       ld de,25            ; width.
       add hl,de           ; point to next line.
       ld a,(hl)           ; first graphic address.
       xor c               ; combine with pixel.
       ld (hl),a           ; new value.
       inc hl              ; next pixel.
       ld a,(hl)           ; second graphic address.
       xor b               ; combine with pixel.
       ld (hl),a           ; new value.
       ret

wplot  call wpixad         ; window point.
       ld a,(hl)           ; first graphic address.
       xor c               ; combine with pixel.
       ld (hl),a           ; new value.
       ret

wpixad ld a,(dispy)        ; horizontal position.
       and 7               ; position straddling character cells.
       ld d,0              ; zero high byte of de.
       ld e,a              ; displacement in de.
       ld hl,wpixel        ; pixels.
       add hl,de           ; point to pixels.
       ld c,(hl)           ; first pixel.
       push bc             ; store data.
       call wadd           ; find window address.
       pop bc              ; restore data.
       ret

wpixel defb 128,64,32,16,8,4,2,1
wpixl2 defb 192,0,96,0,48,0,24,0,12,0,6,0,3,0,1,128


; Calculate window address.
; x coordinates need multiplying by 26, so that's 16 + 8 + 2.

wadd   ld a,(dispx)        ; x coord.
       ld h,0              ; no high byte yet.
       ld l,a              ; low byte in l.
       add hl,hl           ; multiply by 2.
       ld b,h              ; copy total to bc.
       ld c,l
       add hl,hl           ; multiple of 4.
       add hl,hl           ; multiple of 8.
       ld d,h              ; copy total to de.
       ld e,l
       add hl,hl           ; multiple of 16.
       add hl,de           ; add multiple of 8.
       add hl,bc           ; add multiple of 2.
       ld a,(dispy)        ; y coordinate.
       rra                 ; divide by 8.
       rra
       rra
       and 31              ; remove bits shifted in from left.
       ld e,a              ; low byte.
       ld d,0              ; zero high byte.
       add hl,de           ; add y displacement.
       ld de,window        ; address of window.
       add hl,de           ; add to displacement.
       ret                 ; address of window in hl.


; Sine table.

sine   defb 1,1,1,1,1,1,1,1,255,0,255,0,255,0,253,0
       defb 253,0,251,0,249,0,247,0,245,0,245,0,243,0,239,0
       defb 237,0,235,0,233,0,229,0,227,0,223,0,221,0,217,0
       defb 213,0,211,0,207,0,203,0,199,0,195,0,191,0,187,0
       defb 183,0,177,0,173,0,169,0,163,0,159,0,153,0,149,0
       defb 143,0,137,0,133,0,127,0,121,0,117,0,111,0,105,0
       defb 99,0,93,0,87,0,81,0,75,0,69,0,63,0,57,0
       defb 51,0,45,0,39,0,33,0,27,0,19,0,13,0,7,0

       defb 0,0,6,0,12,0,18,0,24,0,32,0,38,0,44,0
       defb 50,0,56,0,62,0,68,0,74,0,80,0,86,0,92,0
       defb 98,0,102,0,108,0,114,0,120,0,126,0,130,0,136,0
       defb 142,0,146,0,152,0,156,0,162,0,166,0,170,0,176,0
       defb 180,0,184,0,188,0,192,0,196,0,200,0,204,0,208,0
       defb 212,0,216,0,218,0,222,0,224,0,228,0,230,0,234,0
       defb 236,0,238,0,240,0,242,0,244,0,246,0,248,0,248,0
       defb 250,0,252,0,252,0,254,0,254,0,254,0,254,0,254,0

       defb 0,1,254,0,254,0,254,0,254,0,254,0,252,0,252,0
       defb 250,0,248,0,248,0,246,0,244,0,242,0,240,0,238,0
       defb 236,0,234,0,230,0,228,0,224,0,222,0,218,0,216,0
       defb 212,0,208,0,204,0,200,0,196,0,192,0,188,0,184,0
       defb 180,0,176,0,170,0,166,0,162,0,156,0,152,0,146,0
       defb 142,0,136,0,130,0,126,0,120,0,114,0,108,0,102,0
       defb 96,0,92,0,86,0,80,0,74,0,68,0,62,0,56,0
       defb 48,0,42,0,36,0,30,0,24,0,18,0,12,0,6,0

arcsin defb 0,0,7,0,13,0,19,0,27,0,33,0,39,0,45,0
       defb 51,0,57,0,63,0,69,0,75,0,81,0,87,0,93,0
       defb 99,0,105,0,111,0,117,0,121,0,127,0,133,0,137,0
       defb 143,0,149,0,153,0,159,0,163,0,169,0,173,0,177,0
       defb 183,0,187,0,191,0,195,0,199,0,203,0,207,0,211,0
       defb 213,0,217,0,221,0,223,0,227,0,229,0,233,0,235,0
       defb 237,0,239,0,243,0,245,0,245,0,247,0,249,0,251,0
       defb 253,0,253,0,255,0,255,0,255,0,1,1,1,1,1,1


; Random number generator.

random ld hl,(seed)        ; pointer.
       ld a,h
       xor (hl)            ; get "random" number from location.
       inc hl              ; increment pointer.
       res 5,h             ; keep within safe area of ROM.
       ld (seed),hl        ; new seed value.
       xor l               ; mix with low byte.
       ret
seed   defw 0
mtbuff defw 0

termin equ $


; Window size = 24*32 (+2 at start).

       org 60960
window equ $
winend equ $+4575          ; last byte of window.











